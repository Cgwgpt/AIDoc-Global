# 上游服务编辑和删除功能使用指南

本指南详细介绍如何使用MedGemma AI诊疗助手的上游服务编辑和删除功能。

## 🎯 功能概述

新增的编辑和删除功能让您可以：
- ✏️ **编辑服务**：修改现有服务的名称、URL、描述和启用状态
- 🗑️ **删除服务**：删除不需要的上游服务（默认服务除外）
- 🔄 **实时更新**：操作后立即生效，无需重启服务

## 🖥️ 通过管理界面操作

### 1. 访问管理控制台

1. 启动服务：`./start.sh`
2. 访问：`http://localhost:8000/ui/`
3. 点击右上角的管理员按钮 ⚙️
4. 输入管理员令牌：`secret-admin`

### 2. 查看服务列表

1. 在右侧"上游服务配置"区域
2. 点击"列出服务"按钮
3. 查看所有配置的上游服务
4. 每个服务都有"✏️ 编辑"和"🗑️ 删除"按钮

### 3. 编辑服务

1. 在服务列表中点击"✏️ 编辑"按钮
2. 在弹出的对话框中修改信息：
   - **服务名称**：输入新的服务名称
   - **服务URL**：输入新的服务地址
   - **服务描述**：输入新的描述信息
   - **启用状态**：选择是否启用此服务
3. 点击"确定"保存更改

**示例：**
```
原服务名称: 备用服务1
新服务名称: 备用服务1（已更新）

原URL: https://backup1.example.com
新URL: https://backup1-updated.example.com

原描述: 备用MedGemma服务
新描述: 更新后的备用MedGemma服务
```

### 4. 删除服务

1. 在服务列表中点击"🗑️ 删除"按钮
2. 在确认对话框中查看要删除的服务信息
3. 点击"确定"确认删除

**注意：**
- 默认服务（`default`）无法删除
- 删除操作不可恢复
- 如果删除的是当前使用的服务，系统会自动切换到默认服务

## 🔧 通过API操作

### 编辑服务

```bash
curl -sS -X PUT http://localhost:8000/api/admin/upstream-services/backup1 \
  -H 'X-Admin-Token: secret-admin' -H 'X-User-Id: 1' \
  -H 'Content-Type: application/json' \
  -d '{
    "name": "备用服务1（已更新）",
    "url": "https://backup1-updated.example.com",
    "description": "更新后的备用服务",
    "enabled": true
  }'
```

### 删除服务

```bash
curl -sS -X DELETE http://localhost:8000/api/admin/upstream-services/backup1 \
  -H 'X-Admin-Token: secret-admin' -H 'X-User-Id: 1'
```

## 📋 操作示例

### 场景1：更新服务URL

**问题**：备用服务的URL发生了变化

**解决步骤**：
1. 列出服务，找到要更新的服务
2. 点击"✏️ 编辑"按钮
3. 更新URL字段
4. 保存更改

### 场景2：禁用有问题的服务

**问题**：某个服务经常出现故障，需要临时禁用

**解决步骤**：
1. 找到有问题的服务
2. 点击"✏️ 编辑"按钮
3. 在启用状态选择"禁用"
4. 保存更改

### 场景3：清理不需要的服务

**问题**：有一些测试服务不再需要

**解决步骤**：
1. 找到不需要的服务
2. 点击"🗑️ 删除"按钮
3. 确认删除操作

## ⚠️ 注意事项

### 编辑服务时
- 确保新的URL格式正确
- 服务名称不能为空
- 修改当前使用的服务会立即生效

### 删除服务时
- 默认服务无法删除
- 删除当前使用的服务会自动切换到默认服务
- 删除操作不可恢复

### 安全考虑
- 只有系统管理员可以编辑和删除服务
- 操作需要管理员令牌验证
- 建议在删除前先禁用服务进行测试

## 🧪 测试功能

运行测试脚本验证功能：

```bash
python test_upstream_config.py
```

测试脚本会：
1. 列出当前服务
2. 添加测试服务
3. 编辑测试服务
4. 检查健康状态
5. 切换服务
6. 删除测试服务
7. 验证最终状态

## 🔍 故障排除

### 编辑失败
- 检查服务键名是否正确
- 确认管理员令牌有效
- 验证新的URL格式

### 删除失败
- 确认不是默认服务
- 检查管理员权限
- 确认服务存在

### 操作后不生效
- 刷新页面查看最新状态
- 检查服务是否正在使用
- 查看系统日志

## 📚 相关文档

- [上游服务配置使用示例](UPSTREAM_CONFIG_DEMO.md)
- [系统管理功能](USAGE.md)
- [API接口文档](README.md)

## 🎉 总结

通过编辑和删除功能，您可以：
- 灵活管理上游服务配置
- 及时更新服务信息
- 清理不需要的服务
- 保持配置的整洁和有效性

这些功能让MedGemma AI诊疗助手的上游服务管理更加完善和便捷！
